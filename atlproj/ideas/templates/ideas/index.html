{% load admin_urls %}
{% load ideas_extras %}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="robots" content="noindex, nofollow">
	
	<!-- BOOTSTRAP CDN INCLUDE -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
	<!-- /BOOTSTRAP -->
	
	{% block extendmeta %}{% endblock %}
	
	<title>{% block title %}Home{% endblock %}</title>
</head>

<body id="home">

	<div class="container">
		
		<div class="row">
			<div class="col">

				{% block nav %}
				<nav class="navbar navbar-expand-lg navbar-light bg-light mb-3">
					<a class="navbar-brand" href="{% if not request.user.is_authenticated %}{% url 'home' %}{% else %}{% url 'index' %}{% endif %}">Atlantic Projects</a>
					<div id="navbarNav">
						<ul class="navbar-nav mr-auto mt-2 mt-lg-0">
						{% block subnav %}
							{% if not request.user.is_authenticated %}
							<li class="nav-item{% block google-nav %}{% endblock %}">
								<a class="nav-link" href="{% url "social:begin" "google-oauth2" %}?next={% url 'index' %}">Log In</a>
							</li>
							{% else %}
							<li class="nav-item dropdown{% block ideas-nav %}{% endblock %}">
								<a class="nav-link dropdown-toggle" href="#" role="button" id="ideas-menu-link" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Ideas</a>
								<div class="dropdown-menu" aria-labelledby="ideas-menu-link">
									<a class="dropdown-item" href="{% url 'index' %}">Dashboard</a>
									<a class="dropdown-item" href="{% url 'idea_list' %}">Available</a>
								    <a class="dropdown-item" href="{% url 'current_list' %}">Now active</a>
								    <a class="dropdown-item" href="{% url 'complete_list' %}">Archived</a>
								    {% if request.user|has_group:"Sales" or request.user|has_group:"Marketing" %}
								    <a class="dropdown-item" href="{% url 'pitch_list' %}">Pitches</a>
								    {% endif %}
								</div>
							</li>
							<li class="nav-item {% block cal-nav %}{% endblock %}">
								<a class="nav-link" href="{% url 'calendar' %}">Calendar</a>
							</li>
								{% if request.user.is_staff %}
								<li class="nav-item{% block admin-nav %}{% endblock %}">
									<a class="nav-link" href="{% url 'admin:index' %}">Admin</a>
								</li>
								{% endif %}
							<li class="nav-item{% block logout-nav %}{% endblock %}">
								<a class="nav-link" href="{% url 'admin:logout' %}">Log Out</a>
							</li>
							{% endif %}
						{% endblock %}
						</ul>
					</div>
				</nav>
				{% endblock %}
				
			</div>
		</div>
		
		{% if need_updates %}
		<div class="row">
			<div class="alert alert-warning" role="alert">
				<h4 class="alert-heading">These ideas need updates.</h4>
			    {% for idea in need_updates %}
	    			<p>
						{% if perms.ideas.change_idea %} 
	    				<small><a href="{% url 'admin:ideas_idea_change' idea.pk %}" class="btn btn-primary btn-sm" target="new">Edit</a></small> 
						{% endif %}
	    				{% short_platform idea display="list" %} <a href="{% url 'idea_detail' idea.id %}">{{ idea }}</a>
	    			</p>
		        {% endfor %}
			</div>
		</div>
		{% endif %}
		
		<div class="row">
			<div class="col">
				
				{% block content %}
				
				<h3>Available</h3>
				
				{% if ideas_list %}
				    <ul>
				    {% for idea in ideas_list %}
		    			<li>{% short_platform idea display="list" %} <a href="{% url 'idea_detail' idea.id %}">{{ idea }}</a>
		    			<br />
		    			<small class="text-muted">{{ idea.description|truncatewords:50 }}</small>
		    			{% idea_children idea %}
		    			</li>
			        {% endfor %}
				    </ul>
				    {% if ideas_list|length > 10 %}<h6><a href="{% url 'idea_list' %}">See all >></a></h6>{% endif %}
				{% else %}
				    <p>We're fresh out of ideas, sorry.</p>
				{% endif %}
				
			</div>
			
			<div class="col">
				
				<h3>Now active</h3>
				
				{% if active_ideas %}
					<ul>
					{% for idea in active_ideas %}
						<li>{% short_platform idea display="current" %} <a href="{% url 'idea_detail' idea.id %}">{{ idea }}</a>
		    			<br />
		    			<small class="text-muted">{{ idea.description|truncatewords:50 }}</small>
		    			</li>
			        {% endfor %}
				    </ul>
				    {% if active_ideas|length > 10 %}<h6><a href="{% url 'current_list' %}">See all >></a></h6>{% endif %}
				{% else %}
				    <p>No projects are currently ongoing.</p>
				{% endif %}
			</div>
				
			<div class="col">
				
				<h3>Coming soon</h3>
				
				{% if calendar %}
				{% regroup calendar by start_date|date:"F" as calendar_list %}
				<ul>
				{% for month in calendar_list %}
					<li><strong>{{ month.grouper }}</strong>
						<ul>
						{% for item in month.list %}
							<li><strong>{% if item.status == "ON_OFFER" or item.status == "TENTATIVE" %}<span class="text-muted">?{% else %}{{ item.start_date|date:"j" }}{% endif %}</strong> - {% if item.parent %}<a href="{% url 'idea_detail' item.parent.id %}">{{ item.parent.short_title }}</a>: {% endif %}<a href="{% url 'idea_detail' item.id %}"{% if item.status == "ON_OFFER" or item.status == "TENTATIVE" %} class="text-warning"{% endif %}>{{ item }}</a> </li>
						{% endfor %}
						</ul>
					</li>
		        {% endfor %}
				    </ul>
				{% if calendar|length > 25 %}<h6><a href="{% url 'calendar' %}">See all >></a></h6>{% endif %}
				{% else %}
				    <p>No projects are coming aboard anytime soon.</p>
				{% endif %}
				
				{% endblock %}
				
			</div>
		</div>
	</div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    
    {% block extendfooter %}{% endblock %}

</body>
</html>